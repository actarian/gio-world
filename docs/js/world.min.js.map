{"version":3,"sources":["docs/js/world.js"],"names":["DragListener","target","downCallback","moveCallback","upCallback","this","document","e","console","log","dragging","init","prototype","onMouseDown","bind","onMouseMove","onMouseUp","onTouchStart","onTouchMove","onTouchEnd","addEventListener","onDown","down","strength","x","y","distance","speed","onDrag","position","window","innerWidth","innerHeight","onUp","removeEventListener","clientX","clientY","addMouseListeners","removeMouseListeners","touches","length","preventDefault","pageX","pageY","addTouchListeners","removeTouchListeners","worldTexture","title","querySelector","shadow","canvas","worldTextureSrc","getAttribute","loader","THREE","TextureLoader","crossOrigin","load","texture","setAttribute","cities","mouse","parallax","renderer","WebGLRenderer","alpha","antialias","shadowMap","enabled","setSize","appendChild","domElement","scene","Scene","fog","FogExp2","camera","PerspectiveCamera","set","up","Vector3","lookAt","directional1","ambient","AmbientLight","add","DirectionalLight","castShadow","shadowCameraVisible","shadowMapWidth","shadowMapHeight","directional2","particleRef","Euler","euler","z","order","worldRotation","Math","PI","worldDragRotation","worldStartDragRotation","worldSpeedRotation","world","parent","rotation","geometry","SphereGeometry","material","MeshStandardMaterial","color","transparent","opacity","roughness","metalness","map","mesh","Mesh","receiveShadow","particles","CanvasTexture","createElement","width","height","ctx","getContext","gradient","createRadialGradient","addColorStop","fillStyle","fillRect","createSprite","Geometry","PointsMaterial","size","vertexColors","VertexColors","blending","AdditiveBlending","depthTest","Points","lat","lon","radius","phi","theta","sin","cos","forEach","point","i","vertex","vertices","push","colors","Color","mergeVertices","verticesNeedUpdate","addParticles","onWindowResize","w2","h2","dragListener","copy","aspect","offsetWidth","TweenLite","offsetHeight","updateProjectionMatrix","render","delta","local","localToWorld","clone","distanceTo","s","max","min","colorsNeedUpdate","titleXy","transform","shadowXy","doParallax","clock","Clock","loop","time","getDelta","requestAnimationFrame","play","createScene"],"mappings":"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","file":"world.min.js","sourcesContent":["/* global window, document, console, THREE, TweenLite, TweenMax, Elastic */\n\n(function() {\n\t'use strict';\n\n\tfunction DragListener(target, downCallback, moveCallback, upCallback) {\n\t\tthis.target = target || document;\n\t\tthis.downCallback = downCallback || function(e) {\n\t\t\tconsole.log('DragListener.downCallback not setted', e);\n\t\t};\n\t\tthis.moveCallback = moveCallback || function(e) {\n\t\t\tconsole.log('DragListener.moveCallback not setted', e);\n\t\t};\n\t\tthis.upCallback = upCallback || function(e) {\n\t\t\tconsole.log('DragListener.upCallback not setted', e);\n\t\t};\n\t\tthis.dragging = false;\n\t\tthis.init();\n\t}\n\n\tDragListener.prototype = {\n\t\tinit: function() {\n\t\t\tthis.onMouseDown = this.onMouseDown.bind(this);\n\t\t\tthis.onMouseMove = this.onMouseMove.bind(this);\n\t\t\tthis.onMouseUp = this.onMouseUp.bind(this);\n\t\t\tthis.onTouchStart = this.onTouchStart.bind(this);\n\t\t\tthis.onTouchMove = this.onTouchMove.bind(this);\n\t\t\tthis.onTouchEnd = this.onTouchEnd.bind(this);\n\t\t\tthis.target.addEventListener('mousedown', this.onMouseDown, false);\n\t\t\tthis.target.addEventListener('touchstart', this.onTouchStart, false);\n\t\t},\n\t\t// events\n\t\tonDown: function(down) {\n\t\t\tthis.down = down; // this.position ? { x: down.x - this.position.x, y: down.y - this.position.y } : down;\n\t\t\tthis.strength = { x: 0, y: 0 };\n\t\t\tthis.distance = this.distance || { x: 0, y: 0 };\n\t\t\tthis.speed = { x: 0, y: 0 };\n\t\t\tthis.downCallback(this);\n\t\t},\n\t\tonDrag: function(position) {\n\t\t\tthis.dragging = true;\n\t\t\tvar target = this.target;\n\t\t\tvar distance = { x: position.x - this.down.x, y: position.y - this.down.y };\n\t\t\tvar strength = { x: distance.x / window.innerWidth * 2, y: distance.y / window.innerHeight * 2 };\n\t\t\tvar speed = { x: this.speed.x + (strength.x - this.strength.x) * 0.1, y: this.speed.y + (strength.y - this.strength.y) * 0.1 };\n\t\t\tthis.position = position;\n\t\t\tthis.distance = distance;\n\t\t\tthis.strength = strength;\n\t\t\tthis.speed = speed;\n\t\t\tthis.moveCallback({\n\t\t\t\tposition: position,\n\t\t\t\tdistance: distance,\n\t\t\t\tstrength: strength,\n\t\t\t\tspeed: speed,\n\t\t\t\ttarget: target,\n\t\t\t});\n\t\t},\n\t\tonUp: function() {\n\t\t\tthis.dragging = false;\n\t\t\tthis.upCallback(this);\n\t\t},\n\t\t// mouse\n\t\tonMouseDown: function(e) {\n\t\t\tthis.target.removeEventListener('touchstart', this.onTouchStart);\n\t\t\tthis.onDown({\n\t\t\t\tx: e.clientX,\n\t\t\t\ty: e.clientY\n\t\t\t});\n\t\t\tthis.addMouseListeners();\n\t\t},\n\t\tonMouseMove: function(e) {\n\t\t\tthis.onDrag({\n\t\t\t\tx: e.clientX,\n\t\t\t\ty: e.clientY\n\t\t\t});\n\t\t},\n\t\tonMouseUp: function(e) {\n\t\t\tthis.removeMouseListeners();\n\t\t\tthis.onDrag({\n\t\t\t\tx: e.clientX,\n\t\t\t\ty: e.clientY\n\t\t\t});\n\t\t\tthis.onUp();\n\t\t},\n\t\t// touch\n\t\tonTouchStart: function(e) {\n\t\t\tthis.target.removeEventListener('mousedown', this.onMouseDown);\n\t\t\tif (e.touches.length > 1) {\n\t\t\t\te.preventDefault();\n\t\t\t\tthis.onDown({\n\t\t\t\t\tx: e.touches[0].pageX,\n\t\t\t\t\ty: e.touches[0].pageY\n\t\t\t\t});\n\t\t\t\tthis.addTouchListeners();\n\t\t\t}\n\t\t},\n\t\tonTouchMove: function(e) {\n\t\t\tif (e.touches.length > 0) {\n\t\t\t\te.preventDefault();\n\t\t\t\tthis.onDrag({\n\t\t\t\t\tx: e.touches[0].pageX,\n\t\t\t\t\ty: e.touches[0].pageY\n\t\t\t\t});\n\t\t\t}\n\t\t},\n\t\tonTouchEnd: function(e) {\n\t\t\tthis.removeTouchListeners();\n\t\t\tthis.onDrag(this.position);\n\t\t\tthis.onUp();\n\t\t},\n\t\t//\n\t\taddMouseListeners: function() {\n\t\t\tdocument.addEventListener('mousemove', this.onMouseMove, false);\n\t\t\tdocument.addEventListener('mouseup', this.onMouseUp, false);\n\t\t},\n\t\taddTouchListeners: function() {\n\t\t\tdocument.addEventListener('touchend', this.onTouchEnd, false);\n\t\t\tdocument.addEventListener('touchmove', this.onTouchMove, false);\n\t\t},\n\t\tremoveMouseListeners: function() {\n\t\t\tdocument.removeEventListener('mousemove', this.onMouseMove);\n\t\t\tdocument.removeEventListener('mouseup', this.onMouseUp);\n\t\t},\n\t\tremoveTouchListeners: function() {\n\t\t\tdocument.removeEventListener('touchend', this.onTouchEnd);\n\t\t\tdocument.removeEventListener('touchmove', this.onTouchMove);\n\t\t},\n\t};\n\n\twindow.DragListener = DragListener;\n\n}());\n\n/* global window, document, console, THREE, TweenLite, TweenMax, Elastic */\n\n(function() {\n\t'use strict';\n\n\tvar title = document.querySelector('.section-world > .title');\n\tvar shadow = document.querySelector('.section-world > .shadow');\n\tvar canvas = document.querySelector('.section-world > .canvas');\n\n\tvar worldTexture, worldTextureSrc = canvas.getAttribute('texture');\n\n\tvar loader = new THREE.TextureLoader();\n\tloader.crossOrigin = '';\n\tloader.load(worldTextureSrc, function(texture) {\n\t\t// texture.wrapS = texture.wrapT = THREE.RepeatWrapping;\n\t\t// texture.repeat.set(2, 2);\n\t\tworldTexture = texture;\n\t\tcreateScene();\n\t});\n\n\tfunction createScene() {\n\n\t\tdocument.querySelector('.section-world').setAttribute('class', 'section-world init');\n\n\t\tvar cities = [\n\t\t\t[43.9096538, 12.8399805], // pesaro\n\t\t\t[41.8519772, 12.2347364], // rome\n\t\t\t[51.5287718, -0.2416791], // london\n\t\t\t[55.6713812, 12.4537393], // copenaghen\n\t\t\t[40.6976637, -74.1197623], // new york\n\t\t\t[19.3911668, -99.4238221], // mexico city\n\t\t\t[39.9390731, 116.11726], // beijing\n\t\t\t[31.2243084, 120.9162376], // shangai\n\t\t];\n\n\t\tvar mouse = { x: 0, y: 0 },\n\t\t\tparallax = { x: 0, y: 0 };\n\n\t\tvar renderer = new THREE.WebGLRenderer({\n\t\t\talpha: true,\n\t\t\tantialias: true\n\t\t});\n\t\trenderer.shadowMap.enabled = true;\n\t\trenderer.setSize(window.innerWidth, window.innerHeight);\n\n\t\t// canvas.innerHTML = '';\n\t\tcanvas.appendChild(renderer.domElement);\n\t\tvar scene = new THREE.Scene();\n\t\tscene.fog = new THREE.FogExp2(0x000000, 0.1); // new THREE.Fog(0x000000, 0, 10);\n\n\t\tvar camera = new THREE.PerspectiveCamera(45, window.innerWidth / window.innerHeight, 0.01, 100);\n\t\tcamera.position.set(0, 1.0, 2.0);\n\t\tcamera.up = new THREE.Vector3(0, 0, -1);\n\t\tcamera.lookAt(new THREE.Vector3(0, 0, 0));\n\n\t\tvar ambient = new THREE.AmbientLight(0x222222);\n\t\tscene.add(ambient);\n\n\t\tvar directional1;\n\t\tdirectional1 = new THREE.DirectionalLight(0xe0e0e0, 0.8);\n\t\tdirectional1.position.set(0, 2, 0.5);\n\t\tdirectional1.castShadow = true;\n\t\tdirectional1.shadowCameraVisible = true;\n\t\tdirectional1.shadowMapWidth = directional1.shadowMapHeight = 2048;\n\t\tscene.add(directional1);\n\n\t\tvar directional2 = new THREE.DirectionalLight(0xe0e0e0, 0.4);\n\t\tdirectional2.position.set(0, -2, 0);\n\t\tscene.add(directional2);\n\n\t\tvar particleRef = new THREE.Vector3(0.0, 0.0, 1.0);\n\t\t// var shadow = addShadow(scene);\n\t\tTHREE.Euler.prototype.add = function(euler) {\n\t\t\tthis.set(this.x + euler.x, this.y + euler.y, this.z + euler.z, this.order);\n\t\t\treturn this;\n\t\t};\n\t\tvar worldRotation = new THREE.Euler(0.0, Math.PI * 1.2, 0.0, 'XYZ');\n\t\tvar worldDragRotation = new THREE.Euler(0, 0, 0, 'XYZ');\n\t\tvar worldStartDragRotation = new THREE.Euler(0, 0, 0, 'XYZ');\n\t\tvar worldSpeedRotation = new THREE.Euler(0, 0, 0, 'XYZ');\n\t\tvar world = addWorld(scene, worldRotation, worldTexture);\n\t\tvar particles = addParticles(world);\n\n\t\twindow.addEventListener('resize', onWindowResize, false);\n\t\tdocument.addEventListener('mousemove', onMouseMove, false);\n\n\t\tvar dragListener = new DragListener(canvas, function(e) {\n\t\t\tworldStartDragRotation.copy(worldDragRotation);\n\t\t}, function(e) {\n\t\t\tworldDragRotation.copy(worldStartDragRotation).add(new THREE.Euler(0, Math.PI * e.strength.x, 0, 'XYZ'));\n\t\t\tworldSpeedRotation.set(0, 0, 0, 'XYZ');\n\t\t}, function(e) {\n\t\t\tworldSpeedRotation.set(0, Math.PI * e.speed.x, 0, 'XYZ');\n\t\t});\n\n\t\tplay();\n\t\tonWindowResize();\n\n\t\tfunction createSprite() {\n\t\t\tvar canvas = document.createElement('canvas');\n\t\t\tcanvas.width = 128;\n\t\t\tcanvas.height = 128;\n\t\t\tvar ctx = canvas.getContext('2d');\n\t\t\tvar gradient = ctx.createRadialGradient(\n\t\t\t\tcanvas.width / 2,\n\t\t\t\tcanvas.height / 2,\n\t\t\t\t0,\n\t\t\t\tcanvas.width / 2,\n\t\t\t\tcanvas.height / 2,\n\t\t\t\tcanvas.width / 2\n\t\t\t);\n\t\t\tgradient.addColorStop(0, 'rgba(255,255,255,1)');\n\t\t\tgradient.addColorStop(0.2, 'rgba(255,255,255,1)');\n\t\t\tgradient.addColorStop(0.22, 'rgba(255,255,255,.2)');\n\t\t\tgradient.addColorStop(1, 'rgba(255,255,255,0)');\n\t\t\tctx.fillStyle = gradient;\n\t\t\tctx.fillRect(0, 0, canvas.width, canvas.height);\n\t\t\treturn canvas;\n\t\t}\n\n\t\tfunction addShadow(parent) {\n\t\t\tvar geometry = new THREE.PlaneGeometry(100, 100);\n\t\t\tgeometry.rotateX(-Math.PI / 4);\n\t\t\tvar material = new THREE.ShadowMaterial();\n\t\t\tmaterial.opacity = 0.2;\n\t\t\tvar mesh = new THREE.Mesh(geometry, material);\n\t\t\tmesh.position.z = -0.6;\n\t\t\tmesh.receiveShadow = true;\n\t\t\tparent.add(mesh);\n\t\t\treturn mesh;\n\t\t}\n\n\t\tfunction addWorld(parent, rotation, texture) {\n\t\t\tvar geometry = new THREE.SphereGeometry(0.5, 48, 48);\n\t\t\t// var geometry2 = new THREE.IcosahedronGeometry(0.5, 4);\n\t\t\t// console.log(geometry2.vertices.length, geometry.vertices.length);\n\t\t\tvar material = new THREE.MeshStandardMaterial({\n\t\t\t\tcolor: '#fff',\n\t\t\t\ttransparent: true,\n\t\t\t\topacity: 0.85,\n\t\t\t\troughness: 0.65,\n\t\t\t\tmetalness: 0.6,\n\t\t\t\tmap: texture,\n\t\t\t});\n\t\t\tvar mesh = new THREE.Mesh(geometry, material);\n\t\t\tmesh.castShadow = true;\n\t\t\tmesh.receiveShadow = false;\n\t\t\tmesh.rotation.set(rotation.x, rotation.y, rotation.z);\n\t\t\tparent.add(mesh);\n\t\t\treturn mesh;\n\t\t}\n\n\t\tfunction addParticles(parent) {\n\t\t\tvar texture = new THREE.CanvasTexture(createSprite());\n\t\t\tvar geometry = new THREE.Geometry();\n\t\t\tvar material = new THREE.PointsMaterial({\n\t\t\t\tsize: 0.07,\n\t\t\t\tmap: texture,\n\t\t\t\tvertexColors: THREE.VertexColors,\n\t\t\t\tblending: THREE.AdditiveBlending,\n\t\t\t\tdepthTest: false,\n\t\t\t\ttransparent: true\n\t\t\t});\n\t\t\tvar particles = new THREE.Points(geometry, material);\n\t\t\tvar points = cities.map(function(x) {\n\t\t\t\treturn calcPosFromLatLonRad(x[0], x[1], 0.5);\n\t\t\t}).forEach(function(point, i) {\n\t\t\t\tvar vertex = new THREE.Vector3();\n\t\t\t\tvertex.x = point.x;\n\t\t\t\tvertex.y = point.y;\n\t\t\t\tvertex.z = point.z;\n\t\t\t\tgeometry.vertices.push(vertex);\n\t\t\t\tgeometry.colors.push(new THREE.Color(0, 0, 0));\n\t\t\t});\n\t\t\tgeometry.mergeVertices();\n\t\t\tgeometry.verticesNeedUpdate = true;\n\t\t\tparticles.geometry = geometry;\n\t\t\tparent.add(particles);\n\t\t\treturn particles;\n\t\t}\n\n\t\tfunction onWindowResize() {\n\t\t\tvar size = {\n\t\t\t\twidth: 0,\n\t\t\t\theight: 0,\n\t\t\t\taspect: 0,\n\t\t\t};\n\t\t\tsize.width = canvas.offsetWidth;\n\t\t\tTweenLite.set(canvas, {\n\t\t\t\theight: canvas.offsetWidth * 0.6\n\t\t\t});\n\t\t\tsize.height = canvas.offsetHeight;\n\t\t\tsize.aspect = size.width / size.height;\n\t\t\tif (renderer) {\n\t\t\t\trenderer.setSize(size.width, size.height);\n\t\t\t}\n\t\t\tif (camera) {\n\t\t\t\tcamera.aspect = size.aspect;\n\t\t\t\tcamera.updateProjectionMatrix();\n\t\t\t}\n\t\t}\n\n\t\tfunction onMouseMove(e) {\n\t\t\tvar w2 = window.innerWidth / 2;\n\t\t\tvar h2 = window.innerHeight / 2;\n\t\t\tmouse = {\n\t\t\t\tx: (e.clientX - w2) / w2,\n\t\t\t\ty: (e.clientY - h2) / h2,\n\t\t\t};\n\t\t\t// console.log('onMouseMove', mouse);\n\t\t}\n\n\t\tfunction doParallax() {\n\t\t\t// parallax\n\t\t\tparallax.x += (mouse.x - parallax.x) / 8;\n\t\t\tparallax.y += (mouse.y - parallax.y) / 8;\n\t\t\t//\n\t\t\tvar titleXy = {\n\t\t\t\tx: -50 + 0.5 * -parallax.x,\n\t\t\t\ty: -50 + 0.5 * -parallax.y,\n\t\t\t};\n\t\t\tTweenLite.set(title, {\n\t\t\t\ttransform: 'translateX(' + titleXy.x + '%) translateY(' + titleXy.y + '%)'\n\t\t\t});\n\t\t\tvar shadowXy = {\n\t\t\t\tx: -50 + 3 * -parallax.x,\n\t\t\t\ty: -50 + 3 * -parallax.y,\n\t\t\t};\n\t\t\tTweenLite.set(shadow, {\n\t\t\t\ttransform: 'translateX(' + shadowXy.x + '%) translateY(' + shadowXy.y + '%)'\n\t\t\t});\n\t\t\tdirectional1.position.set(parallax.x * 0.3, 2 + parallax.y * 0.3, 0.5);\n\t\t\tdirectional2.position.set(parallax.x * 0.3, -2 + parallax.y * 0.3, 0);\n\t\t}\n\n\t\tfunction render(delta) {\n\t\t\tif (!dragListener.dragging) {\n\t\t\t\tworldRotation.y += worldSpeedRotation.y;\n\t\t\t\tworldSpeedRotation.y += (0.002 - worldSpeedRotation.y) / 50;\n\t\t\t}\n\t\t\tworld.rotation.copy(worldRotation).add(worldDragRotation);\n\t\t\tparticles.geometry.vertices.forEach(function(vertex, i) {\n\t\t\t\tvar local = world.localToWorld(vertex.clone());\n\t\t\t\tvar distance = local.distanceTo(particleRef);\n\t\t\t\tvar s = Math.max(0, Math.min(1, (1 - distance))) * 5;\n\t\t\t\tparticles.geometry.colors[i] = new THREE.Color(s, s, s);\n\t\t\t\tparticles.geometry.colorsNeedUpdate = true;\n\t\t\t});\n\t\t\trenderer.render(scene, camera);\n\t\t\tdoParallax();\n\t\t}\n\n\t\tfunction calcPosFromLatLonRad(lat, lon, radius) {\n\t\t\tvar phi = (90 - lat) * (Math.PI / 180);\n\t\t\tvar theta = (lon + 180) * (Math.PI / 180);\n\t\t\tvar x = -((radius) * Math.sin(phi) * Math.cos(theta));\n\t\t\tvar z = ((radius) * Math.sin(phi) * Math.sin(theta));\n\t\t\tvar y = ((radius) * Math.cos(phi));\n\t\t\treturn new THREE.Vector3(x, y, z);\n\t\t}\n\n\t\tfunction play() {\n\t\t\tvar clock = new THREE.Clock();\n\n\t\t\tfunction loop(time) {\n\t\t\t\tvar delta = clock.getDelta();\n\t\t\t\trender(delta);\n\t\t\t\twindow.requestAnimationFrame(loop);\n\t\t\t}\n\t\t\tloop();\n\t\t}\n\n\t}\n\n}());\n"]}